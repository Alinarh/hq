<%= form_for @discipline, html: { class: 'form-horizontal', role: 'form' } do |f|%>
  <% if @discipline.errors.any? %>
    <%= params.inspect %>
    <%= @discipline.errors.inspect %>
  <% end %>

  <div class="form-group <%= 'has-error' if @discipline.errors.include?(:year) %>">
    <%= f.label :year, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <%= f.select :year, options_for_select(%w(2013), 2013), {}, { class: 'form-control' } %>
    </div>
  </div>

  <div class="form-group <%= 'has-error' if @discipline.errors.include?(:semester) %>">
    <%= f.label :semester, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <%= f.select :semester, [['осенний', 1], ['весенний', 2]], {}, { class: 'form-control' } %>
    </div>
  </div>

  <div class="form-group">
    <%= label_tag 'faculty', 'Институт', class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <%= select_tag 'faculty',
                     options_from_collection_for_select(Department.faculties,
                                                        :id, :abbreviation, (@faculty.id if @faculty)),
                     class: 'form-control ajax-faculty' %>
    </div>
  </div>

  <div class="form-group">
    <%= label_tag 'speciality', 'Направление', class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <% if @faculty %>
        <%= select_tag 'speciality', options_for_select(@faculty.specialities.map { |s| ["#{s.code} #{s.name}", s.id] }, @speciality.id), class: 'form-control ajax-speciality' %>
      <% else %>
        <%= select_tag 'speciality', nil, class: 'form-control ajax-speciality' %>
      <% end %>
    </div>
  </div>

  <div class="form-group <%= 'has-error' if @discipline.errors.include?(:group) %>">
    <%= f.label :subject_group, 'Группа', class: 'control-label col-sm-3' %>
    <div class='col-sm-9'>
      <% if @speciality %>
        <%= f.select :subject_group, options_from_collection_for_select(@speciality.groups, :id, :name, @discipline.group.id), {}, { class: 'form-control ajax-group' } %>
      <% else %>
        <%= f.select :subject_group, [], {}, { class: 'form-control ajax-group' } %>
      <% end %>
    </div>
  </div>

  <div class="form-group <%= 'has-error' if @discipline.errors.include?(:name) %>">
    <%= f.label :name, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <%= f.text_field :name, placeholder: 'например, "Компьютерная обработка изображений"', class: 'form-control' %>
      <span class="help-block">
        Пожалуйста, используйте полное название дисциплины из учебного плана.
        Не допускайте сокращений.
      </span>
    </div>
  </div>

  <%= f.fields_for :exams do |sub_f| %>
    <div class="form-group <%= 'has-error' if @discipline.errors.include?(:'exams.type') %>">
      <%= sub_f.label :exam_type, 'Форма испытания',class: 'control-label col-sm-3' %>
      <div class="col-sm-9">
        <%= sub_f.select :exam_type, options_for_select([['экзамен', 1], ['зачёт', 0], ['дифференцированный зачёт', 9]]), { prompt: 'выберите форму итогового контроля' }, { class: 'form-control' } %>
      </div>
    </div>

    <div class="form-group <%= 'has-error' if @discipline.errors.include?(:'exams.weight') %>">
      <%= sub_f.label :exam_weight, 'Вес экзамена',class: 'control-label col-sm-3' %>
      <div class="col-sm-9">
        <%= sub_f.number_field :exam_weight, class: 'form-control' %>
        <span class="help-block">Рекомендуемое значение — 50%.</span>
      </div>
    </div>
  <% end %>

  <div class="form-group">
    <div class="col-sm-offset-3 col-sm-9">
      <div class="checkbox">
        <label>
          <%= hidden_field_tag :has_semester_work %>
          <%= check_box_tag :has_semester_work, 1 , @discipline.has?('work') %> Присутствует курсовая работа
        </label>
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-offset-3 col-sm-9">
      <div class="checkbox">
        <label>
          <%= hidden_field_tag :has_semester_project %>
          <%= check_box_tag :has_semester_project, 1, @discipline.has?('project') %> Присутствует курсовой проект
        </label>
      </div>
    </div>
  </div>

  <div class="form-group <%= 'has-error' if @discipline.errors.include?(:lead_teacher) %>">
    <%= f.label :subject_teacher, 'Ведущий преподаватель',class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <%= f.select :subject_teacher,
        options_from_collection_for_select(@teachers, :id, :full_name, @lead_teacher.id), {}, { class: 'form-control' } %>
      <span class="help-block">
        Под ведущим преподавателем понимается тот, который будет принимать
        в конце семестра у студентов зачёт/экзамен и, соответственно,
        расписываться в зачётной/экзаменационной ведомости.
      </span>
    </div>
  </div>

  <%= f.fields_for :discipline_teachers, @discipline.discipline_teachers do |sub_f| %>
    <div class="form-group">
      <%= sub_f.label :teacher_id, 'Доп. преподаватель', class: 'control-label col-sm-3' %>
      <div class="col-sm-9">
        <%= sub_f.select :teacher_id, options_from_collection_for_select(@teachers.delete_if { |t| t == @lead_teacher }, :id, :full_name, @discipline.discipline_teachers[sub_f.index].teacher_id), { include_blank: 'если необходимо — укажите дополнительного преподавателя' }, { class: 'form-control' } %>
      </div>
    </div>
  <% end %>
  <div class="form-group">
    <div class="col-sm-offset-3 col-sm-9">
        <span class="help-block">
          Если дисциплину ведут несколько преподавателей — укажите их здесь.
          Главного преподавателя второй раз указывать не надо.
        </span>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-offset-3 col-sm-9">
      <%= f.submit 'Сохранить дисциплину', class: 'btn btn-primary' %>
    </div>
  </div>
<% end %>