<%= nested_form_for @exam, url: study_discipline_exam_path(@discipline, @exam),
                    method: :patch, html: { class: 'form-horizontal marks', role: 'form'} do |f| %>
  <div class="form-group">
    <%= f.label :group, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <p class="form-control-static"><%= @discipline.group.name %></p>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :discipline, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <p class="form-control-static"><%= @discipline.name %></p>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :date, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <p class="form-control-static"><%= l @exam.date %></p>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :type, class: 'control-label col-sm-3' %>
    <div class="col-sm-9">
      <p class="form-control-static"><%= @exam.name %></p>
    </div>
  </div>

  <table class="table table-hover">
    <tr>
      <th class="text-muted">#</th>
      <th>Студент</th>
      <th>Баллы</th>
      <th></th>
      <th>Результат</th>
    </tr>
  <% @discipline.group.students.each do |student| %>
    <tr>
      <td class="text-muted"><%= student.id %></td>
      <td><%= student.person.full_name %></td>
      <td><%= student.ball(@exam.discipline) %> +</td>

      <% mark = @exam.exammarks.by_student(student).last %>
      <% if mark == nil %>
        <td><%= text_field_tag "mark_#{student}", nil, class: 'form-control', style: 'width: 50px' %></td>
        <td>
          <%= render 'marks_fields',
                     f: f, student: student.id %>
        </td>
      <% else %>
        <td><p class="form-control-static">балл на экзамене</p></td>
        <td>
          <span  class="label label-<%= mark.mark < @checkpoint.min ? 'danger' : 'success' %>"><%= mark.mark %> из <%= @checkpoint.max %></span>
          <div class="editMarkField hidden">
            <br>
            <%= render 'marks_fields',
                       f: f, student: student.id %>
          </div>
        </td>
        <!--<td><button class="btn btn-default editMarkButton">Редактировать</button></td>-->
      <% end %>
    </tr>
  <% end %>
  </table>
  <div class="col-sm-3 col-sm-offset-4">
    <%= f.submit 'Внести результаты', class: 'btn btn-primary' %>
  </div>

<% end %>