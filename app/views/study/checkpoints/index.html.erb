<div class="page-header">
  <h1>
    <%= @discipline.name %> <small><%= @discipline.group.name %></small>
  </h1>
</div>

<%= link_to new_study_discipline_checkpoint_path(@discipline),
            class: 'btn btn-default navigation_trip hidden-print', id: 'edit_checkpoints_button',
            data: { input: '#edit_checkpoints_button', content: 'Вы можете отредактировать своё расписание
                        <br>или информацию по контрольным точкам, пройдя по данной ссылке.',
                    position: 's'}  do %>
  <span class="glyphicon glyphicon-calendar"></span>
  Расписание
<% end %>

<%= link_to edit_study_discipline_path(@discipline), class: 'btn btn-default navigation_trip hidden-print',
            id: 'edit_discipline_button', data: { input: '#edit_discipline_button',
            content: 'Вы можете редактировать карту дисциплины. Для этого пройдите по данной ссылке.',
            position: 's'} do %>
  <span class="glyphicon glyphicon-edit"></span> Редактировать дисциплину
<% end %>

<%= link_to study_discipline_print_group_path(@discipline), class: 'btn btn-default navigation_trip hidden-print',
            id: 'print_students_list', data: { input: '#print_students_list',
            content: 'Чтобы распечатать список студентов группы, нажмите на эту кнопку.',
            position: 's'} do %>
  <span class='glyphicon glyphicon-print'></span> Студенты
<% end %>

<%= link_to study_group_discipline_path(@discipline.group, @discipline), class: 'btn btn-info pull-right navigation_trip hidden-print',
            id: 'show_progress', data: { input: '#show_progress',
            content: 'Вы можете перейти на страницу с успеваемостью по этой дисциплине.',
            position: 'w'} do %>
  <span class='glyphicon glyphicon-eye-open'></span> Успеваемость
<% end %>

<div id="not-full-classes">
  <%= render partial: 'not_full', locals: {classes: @classes, discipline: @discipline} %>
</div>
<div class="row">
  <table class="table table-striped">
    <thead>
    <tr>
      <th class="text-muted">#</th>
      <th>Дата</th>
      <th>Тип занятия</th>
      <th></th>
      <th></th>
    </tr>
    </thead>
    <tbody>
    <% @discipline.classes.each  do |checkpoint| %>
      <tr>
        <td class="text-muted"><%= checkpoint.id %></td>
        <td class="date"><%= l checkpoint.date %></td>
        <td class="full-width">
          <%= '<strong>'.html_safe if checkpoint.is_checkpoint? %>

          <span class="glyphicon <%= checkpoint.lesson %>"></span>
          <%= checkpoint.name if checkpoint.type == 3 %>
          <%= checkpoint.lessonname %>

          <%= '</strong>'.html_safe if checkpoint.is_checkpoint? %>
        </td>
        <td>
          <%= button_tag  class: 'btn btn-default change_date_buttons navigation_trip hidden-print',
                      data: { input: '.change_date_buttons:first-child', content: 'Вы можете изменить дату проведения занятия.',
                              position: 'w', value: checkpoint.id, parent: checkpoint.discipline.id} do %>
            <span class="glyphicon glyphicon-calendar"></span> Изменить дату
          <% end %>
        </td>
        <td>
          <div class="pull-right">
            <% unless checkpoint.date.future? %>
              <%= link_to study_discipline_checkpoint_marks_path(@discipline, checkpoint), class: 'btn btn-default add_marks_buttons navigation_trip hidden-print',
                          data: { input: '.add_marks_buttons:first-child', content: 'Вы можете внести результаты по проведённому занятию.',
                                  position: 'w'} do %>
                <span class="glyphicon glyphicon-pencil"></span> Внести результаты
              <% end %>
              <% if checkpoint.marks.length == 0 %>
                <br><br>
                <%= link_to study_discipline_checkpoint_path(@discipline, checkpoint), method: :delete, confirm: 'Вы уверены?',
                            class: 'btn btn-danger pull-right delete_checkpoint navigation_trip hidden-print',
                            data: { input: '.delete_checkpoint:first-child', content: 'Вы можете удалить занятия, которые еще не прошли.',
                                    position: 'w'} do %>
                  <span class="glyphicon glyphicon-remove"></span> Удалить
                <% end %>
              <% end %>
            <% else %>
              <%= link_to study_discipline_checkpoint_path(@discipline, checkpoint), method: :delete, confirm: 'Вы уверены?',
                          class: 'btn btn-danger delete_checkpoint hidden-print' do %>
                <span class="glyphicon glyphicon-remove"></span> Удалить
              <% end %>
            <% end %>
          </div>
        </td>
      </tr>
    <% end %>

    <% if false %>
      <% @discipline.exams.originals.order('exam_date').each do |exam| %>
        <% if exam.date? %>
          <tr>
            <td class="text-muted"><%= exam.id %></td>
            <td><%= l exam.date %></td>
            <td class="full-width">
              <span class="glyphicon glyphicon-<%= exam == @discipline.final_exam ? 'star' :  'star-empty' %>"></span> <%= exam.name %>
            </td>
            <td>
              <div class="pull-right">
                <%= link_to study_discipline_exam_path(@discipline, exam), class: 'btn btn-default', title: 'Внести результаты экзамена' do %>
                  <span class="glyphicon glyphicon-pencil"></span>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      <% end %>
    <% end %>
    </tbody>
  </table>
  <div id="forModalChange"></div>
  <a data-toggle="modal" href="#changeDate"  class="hidden" id="changeDateModalBtn"></a>
</div>
