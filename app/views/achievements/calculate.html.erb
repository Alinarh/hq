<div class="page-header">
  <h2>Расчёт надбавок</h2>
</div>

<form class="form-inline" style="margin-bottom: 15px;">
  <div class="form-group">
    <label>Институт</label>
    <%= select_tag :department, options_for_select(Department.where(department_id: @departments).map { |d| [d.abbreviation, d.id] }, params[:department]),
                   class: 'form-control', onchange: %q($(this).parents('form').submit();) %>
  </div>
</form>

<ul>
  <li>Минимальный балл — <%= @sums.min_by { |pair| pair[1] }[1] %></li>
  <li>Максимальный балл — <%= @sums.max_by { |pair| pair[1] }[1] %></li>
</ul>

<%= render_distribution("Распределение баллов — #{@department.abbreviation}", @sums, id: 'sums') %>
<%= render_distribution("Распределение баллов без дополнительных показателей — #{@department.abbreviation}", @sums_without_additional, id: 'sums_without_additional') %>

<table class="table table-striped">
  <thead>
    <tr>
      <th>#</th>
      <th>НПР</th>
      <th>Сумма баллов</th>
    </tr>
  </thead>
  <% @sums.sort_by { |p| p[1] }.each do |user_id, credit| %>
    <tr>
      <td><%= user_id %></td>
      <td><%= User.find(user_id).full_name %></td>
      <td><%= credit %></td>
    </tr>
  <% end %>
</table>


